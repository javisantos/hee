import{MyBaseElement,html,helpers}from'./my-base-element.mjs';class MyHeeBaseElement extends MyBaseElement{constructor(){if(super(),this.source=this.dataset.eventsource?this.dataset.eventsource:null,!this.source)throw new Error('You need to define data-eventsource attribute');window.eventSources||(window.eventSources=new Map)}static get is(){return'my-hee-base-component'}connected(){this.source&&this.initEventSource(),window.addEventListener('beforeunload',()=>{window.eventSources.get(this.source).close()}),window.addEventListener('load',()=>{}),this.loaded=!0}disconnected(){this.eventSource&&this.eventSource.close()}initEventSource(){if(!this.loaded){window.eventSources.has(this.source)||window.eventSources.set(this.source,new EventSource(this.source)),this.eventSource=window.eventSources.get(this.source),this.eventSource.onmessage=()=>{},this.eventSource.onopen=()=>{},this.eventSource.onerror=()=>{},this.eventSource.addEventListener('ready',()=>{this.ready()});var a=EventSource.prototype.addEventListener;EventSource.prototype.addEventListener=function(b,c){a.call(this,b,(a,d=c)=>{let e=`on${b.replace(/^\w/,a=>a.toUpperCase())}`;'function'==typeof d[e]&&d[e](a)})},this.constructor.observedSSE.forEach(a=>{this.eventSource.addEventListener(a,this)})}}postState(a){fetch(`${this.source}`,{method:'POST',mode:'cors',headers:{"Content-Type":'application/json'},body:JSON.stringify(a)}).catch(a=>console.error(`Fetch Error =\n`,a)).then(()=>{})}}export{MyHeeBaseElement,html,helpers};